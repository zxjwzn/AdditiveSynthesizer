# ==============================================================================
#  AdditiveSynthesizer -- CMake build (CI / cross-platform)
#
#  Auto-generated by init-vscode.ps1. For GitHub Actions CI.
#  Local development uses Projucer + Visual Studio.
# ==============================================================================

cmake_minimum_required(VERSION 3.22)

project(AdditiveSynthesizer
    VERSION     0.0.1
    LANGUAGES   CXX
)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
set(CMAKE_MSVC_RUNTIME_LIBRARY "MultiThreaded$<$<CONFIG:Debug>:Debug>DLL")

# -- Fetch JUCE ----------------------------------------------------------------
include(FetchContent)

set(JUCE_GIT_TAG "8.0.12" CACHE STRING "JUCE version (git tag)")

FetchContent_Declare(
    juce
    GIT_REPOSITORY  https://github.com/juce-framework/JUCE.git
    GIT_TAG         ${JUCE_GIT_TAG}
    GIT_SHALLOW     ON
)
FetchContent_MakeAvailable(juce)

# -- Plugin Target -------------------------------------------------------------
juce_add_plugin(AdditiveSynthesizer
    COMPANY_NAME                "Zaxpris"
    PLUGIN_MANUFACTURER_CODE    Manu
    PLUGIN_CODE                 Plgn
    FORMATS                     VST3 Standalone
    PRODUCT_NAME                "AdditiveSynthesizer"
    IS_SYNTH                    TRUE
    NEEDS_MIDI_INPUT            TRUE
    NEEDS_MIDI_OUTPUT           FALSE
    IS_MIDI_EFFECT              FALSE
    EDITOR_WANTS_KEYBOARD_FOCUS TRUE
    COPY_PLUGIN_AFTER_BUILD     FALSE
    VST3_CATEGORIES             "Instrument|Synth"
)

juce_generate_juce_header(AdditiveSynthesizer)

# -- Sources (auto-glob: no manual updates needed when adding files) -----------
file(GLOB_RECURSE PLUGIN_SOURCES CONFIGURE_DEPENDS
    "${CMAKE_CURRENT_SOURCE_DIR}/Source/*.cpp"
    "${CMAKE_CURRENT_SOURCE_DIR}/Source/*.h"
)

target_sources(AdditiveSynthesizer
    PRIVATE
        ${PLUGIN_SOURCES}
)

target_include_directories(AdditiveSynthesizer
    PRIVATE
        ${CMAKE_CURRENT_SOURCE_DIR}/Source
)

# -- Compile Definitions -------------------------------------------------------
target_compile_definitions(AdditiveSynthesizer
    PUBLIC
        JUCE_STRICT_REFCOUNTEDPOINTER=1
        JUCE_VST3_CAN_REPLACE_VST2=0
        JUCE_WEB_BROWSER=0
        JUCE_USE_CURL=0
)

if(MSVC)
    target_compile_options(AdditiveSynthesizer PRIVATE /utf-8)
endif()

# -- Link JUCE Modules --------------------------------------------------------
target_link_libraries(AdditiveSynthesizer
    PRIVATE
        juce::juce_audio_basics
        juce::juce_audio_devices
        juce::juce_audio_formats
        juce::juce_audio_processors
        juce::juce_audio_utils
        juce::juce_core
        juce::juce_data_structures
        juce::juce_dsp
        juce::juce_events
        juce::juce_graphics
        juce::juce_gui_basics
        juce::juce_gui_extra
        juce::juce_opengl
    PUBLIC
        juce::juce_recommended_config_flags
        juce::juce_recommended_warning_flags
)
